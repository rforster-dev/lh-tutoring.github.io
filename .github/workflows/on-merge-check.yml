name: Pipeline Check

on:
  push:
    branches-ignore:
      - "*"

jobs:
  check_pipeline:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Get previous commit SHA
        id: prev_commit
        run: |
          echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
          echo "::set-output name=sha_short::$(git rev-parse --short HEAD)"

      - name: Check for changes in package.json
        id: check_changes
        run: |
          CHANGED_FILES=$(git diff --name-only ${{ steps.prev_commit.outputs.sha_short }} HEAD | grep -E "package\.json$" || true)
          echo "$CHANGED_FILES"
          if [[ -n "$CHANGED_FILES" ]]; then
            echo "::set-output name=changed::true"
          else
            echo "::set-output name=changed::false"
          fi

      - name: Trigger pipeline check
        if: ${{ steps.check_changes.outputs.changed == 'true' }}
        run: |
          # Perform actions to trigger pipeline check, e.g., API call or running a script
          echo "Pipeline check triggered"
